# Gemini API 配額問題解決方案

## 問題分析

從錯誤日誌可以看到：
```
429 RESOURCE_EXHAUSTED: You exceeded your current quota
```

這表示你的 Gemini API 免費配額已用盡。

## 配額限制（免費版）

### Gemini 2.5 Flash Image Preview 免費配額：
- **每分鐘請求數**：有限制
- **每天請求數**：有限制  
- **輸入 token 數**：每分鐘有限制

## 解決方案

### 1. 立即解決（免費）
- **等待重置**：配額通常會在一段時間後重置
- **降低使用頻率**：避免短時間內多次請求

### 2. 升級方案（付費）
前往 [Google AI Studio](https://aistudio.google.com/) 設定付費方案

### 3. 程式碼優化（已實作）
- ✅ 添加重試機制
- ✅ 更好的錯誤訊息
- ✅ 配額錯誤特別處理
- ✅ 修復 LINE Bot API 參數錯誤

## 目前的改進

### 錯誤處理
- 429 錯誤會顯示友善的訊息給用戶
- 自動重試機制（1次重試，延遲15秒）
- 修復了 `push_message` API 參數錯誤

### 使用建議
1. **測試時機**：避開高峰時段
2. **控制頻率**：不要連續多次請求
3. **檢查配額**：定期檢查 Google AI Studio 的使用量

## 檢查配額狀態

1. 前往 [Google AI Studio](https://aistudio.google.com/)
2. 登入你的 Google 帳號
3. 查看 "Usage" 或 "Billing" 頁面
4. 檢查當前配額使用狀況

## 測試時的注意事項

```bash
# 測試前先等待一段時間讓配額重置
# 避免在短時間內多次呼叫圖片生成功能

# 如果要測試，建議間隔至少 1-2 分鐘
!image 簡單的測試圖片
# 等待 1-2 分鐘
!image 另一張測試圖片
```

## 配額重置時間

- **每分鐘配額**：通常在下一分鐘重置
- **每日配額**：UTC 時間每日重置
- **具體時間**：依 Google 政策而定

現在你的程式碼已經能正確處理這些錯誤，並給用戶友善的提示訊息。
